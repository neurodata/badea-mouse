

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Hierarchical Clustering Analysis - MASE &#8212; Mouse Connectomes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '2022-02-18-multigraph-clustering-mase';</script>
    <link rel="shortcut icon" href="_static/nd_logo_small.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="coverpage.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/nd_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/nd_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="coverpage.html">
                    Mouse Brain and Alzheimer’s Disease
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Brain Volume Covariances</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2022-01-28-volume-analysis.html">Brain Volume Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022-03-15-multimodal-clustering.html">Test whether brain volume and FA are independent</a></li>



<li class="toctree-l1"><a class="reference internal" href="2022-08-20-label-cmp.html">Comparing Subgroups of Edges</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022-11-17-volume-correlation-analysis-ranked.html">Exploratory analysis on volume correlations</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022-11-18-multigraph-clustering.html">Hierarchical Clustering Analysis - Omnibus Embedding</a></li>
<li class="toctree-l1"><a class="reference internal" href="2023-01-10-nonpar.html">K-sample latent position distribution test</a></li>
<li class="toctree-l1"><a class="reference internal" href="2023-03-01-volume-differences.html">Comparisons of differences in brain regions</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/neurodata/badea-mouse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/neurodata/badea-mouse/issues/new?title=Issue%20on%20page%20%2F2022-02-18-multigraph-clustering-mase.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/2022-02-18-multigraph-clustering-mase.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Hierarchical Clustering Analysis - MASE</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#embed-the-data-simultaneously-using-multiple-adjacency-spectral-embedding-mase">Embed the data simultaneously using Multiple Adjacency Spectral Embedding (MASE)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-hierarchical-clustering">Perform hierarchical clustering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-cluster-labeling-along-with-apriori-labels-using-sankey-diagrams">Plotting the cluster labeling along with apriori labels using Sankey diagrams</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-different-clustering-levels-using-heatmaps">Visualizing different clustering levels using heatmaps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-significantly-different-clusters-at-various-levels">Testing for significantly different clusters at various levels</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ksample-testing-results">Ksample testing results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-differences-in-pairwise-subgraph-covariances">Testing for differences in pairwise subgraph covariances</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="hierarchical-clustering-analysis-mase">
<h1>Hierarchical Clustering Analysis - MASE<a class="headerlink" href="#hierarchical-clustering-analysis-mase" title="Permalink to this heading">#</a></h1>
<p>In this notebook, we will use multiple adjacency spectral embedding (MASE) instead of omnibus embedding to obtain a low dimensional vector representation of vertices in our correlation matrices</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">graspologic</span> <span class="k">as</span> <span class="nn">gp</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">hyppo</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;png&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## Read the brain region information</span>
<span class="c1"># t = pd.read_excel(&quot;../data/raw/CHASSSYMM3AtlasLegends.xlsx&quot;, engine=&#39;openpyxl&#39;)</span>

<span class="c1"># pd.concat([t, cluster_label_df], axis=1).to_csv(&quot;CHASSSYMM3AtlasLegends.csv&quot;, index=False)</span>

<span class="c1"># out = pd.concat([node_labels, cluster_label_df], axis=1)</span>

<span class="c1"># out.to_csv(&quot;./out.csv&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Read the data</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/processed/key.csv&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/processed/mouses-volumes.csv&#39;</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">DWI</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">genotypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;APOE22&#39;</span><span class="p">,</span> <span class="s1">&#39;APOE33&#39;</span><span class="p">,</span> <span class="s1">&#39;APOE44&#39;</span><span class="p">]</span>

<span class="n">gen_animals</span> <span class="o">=</span> <span class="p">{</span><span class="n">genotype</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">genotype</span> <span class="ow">in</span> <span class="n">genotypes</span><span class="p">}</span>

<span class="k">for</span> <span class="n">genotype</span> <span class="ow">in</span> <span class="n">genotypes</span><span class="p">:</span>
    <span class="n">gen_animals</span><span class="p">[</span><span class="n">genotype</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;Genotype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">genotype</span><span class="p">][</span><span class="s1">&#39;DWI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">vol_dat</span> <span class="o">=</span> <span class="p">{</span><span class="n">genotype</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">genotype</span> <span class="ow">in</span> <span class="n">genotypes</span><span class="p">}</span>
    
<span class="k">for</span> <span class="n">genotype</span> <span class="ow">in</span> <span class="n">genotypes</span><span class="p">:</span>
    <span class="n">vol_dat</span><span class="p">[</span><span class="n">genotype</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gen_animals</span><span class="p">[</span><span class="n">genotype</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    
<span class="c1">## Compute correlations</span>
<span class="n">cor_dat</span> <span class="o">=</span> <span class="p">{</span><span class="n">genotype</span><span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetrize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">genotype</span><span class="p">,</span> <span class="n">dat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">vol_dat</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1">## Node hierarchical label data</span>
<span class="n">node_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/processed/node_label_dictionary.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node_labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Structure</th>
      <th>Abbreviation</th>
      <th>Hemisphere</th>
      <th>Level_1</th>
      <th>Level_2</th>
      <th>Level_3</th>
      <th>Level_4</th>
      <th>Subdivisions_7</th>
      <th>index</th>
      <th>index2</th>
      <th>clusfound</th>
      <th>Subdivisions_7_nowm</th>
      <th>Hemisphere_abbrev</th>
      <th>Level_1_abbrev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cingulate_Cortex_Area_24a</td>
      <td>A24a</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>1</td>
      <td>1.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Cingulate_Cortex_Area_24a_prime</td>
      <td>A24aPrime</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>2</td>
      <td>2.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Cingulate_Cortex_Area_24b</td>
      <td>A24b</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>3</td>
      <td>3.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Cingulate_Cortex_Area_24b_prime</td>
      <td>A24bPrime</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>4</td>
      <td>4.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Cingulate_Cortex_Area_29a</td>
      <td>A29a</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>5</td>
      <td>5.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>327</th>
      <td>IntermediateReticularNucleus</td>
      <td>IRN.1</td>
      <td>Right</td>
      <td>3_hindbrain</td>
      <td>2_pontine_hindbrain</td>
      <td>NaN</td>
      <td>axial_hindbrain_white_matter</td>
      <td>6_hindbrain</td>
      <td>328</td>
      <td>1162.0</td>
      <td>0</td>
      <td>6_hindbrain</td>
      <td>R</td>
      <td>HB</td>
    </tr>
    <tr>
      <th>328</th>
      <td>PosteriorDorsal_ParaventricularMedialParvicell...</td>
      <td>PHD_PaMP_Post_and_LatHy.1</td>
      <td>Right</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>8_rostral_secondary_prosencephalon</td>
      <td>5_hypothalamus</td>
      <td>4_diencephalon</td>
      <td>329</td>
      <td>1163.0</td>
      <td>0</td>
      <td>4_diencephalon</td>
      <td>R</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>329</th>
      <td>Prerubral_Forel</td>
      <td>PR_p3Tg_L.1</td>
      <td>Right</td>
      <td>1_forebrain</td>
      <td>2_diencephalon</td>
      <td>p2_and_p3</td>
      <td>17_thalamus</td>
      <td>4_diencephalon</td>
      <td>330</td>
      <td>1164.0</td>
      <td>0</td>
      <td>4_diencephalon</td>
      <td>R</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>330</th>
      <td>PVG_of_Hypothalamus</td>
      <td>PVG.1</td>
      <td>Right</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>8_rostral_secondary_prosencephalon</td>
      <td>5_hypothalamus</td>
      <td>4_diencephalon</td>
      <td>331</td>
      <td>1165.0</td>
      <td>0</td>
      <td>4_diencephalon</td>
      <td>R</td>
      <td>FB</td>
    </tr>
    <tr>
      <th>331</th>
      <td>Basal Lateral Amygdala</td>
      <td>BLA.1</td>
      <td>Right</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>6_subpallium</td>
      <td>8_pallial_and_subpallial_amygdala</td>
      <td>2_pallium</td>
      <td>332</td>
      <td>1166.0</td>
      <td>0</td>
      <td>2_pallium</td>
      <td>R</td>
      <td>FB</td>
    </tr>
  </tbody>
</table>
<p>332 rows × 14 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Plot to make sure nothing is wrong</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
    <span class="c1">#constrained_layout=True, </span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="p">)</span>


<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">genotype</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cor_dat</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">gp</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">adjplot</span><span class="p">(</span>
        <span class="n">cor_dat</span><span class="p">[</span><span class="n">genotype</span><span class="p">],</span> 
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span>
        <span class="n">group</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Hemisphere_abbrev&#39;</span><span class="p">,</span> <span class="s1">&#39;Level_1_abbrev&#39;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genotype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">135</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        
        
<span class="c1">#fig.tight_layout(pad=3.0)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bf36228d01ac2452e6b48d836ee4dadb5fe13ed6954fcfa2faf681b89c68e641.png" src="_images/bf36228d01ac2452e6b48d836ee4dadb5fe13ed6954fcfa2faf681b89c68e641.png" />
</div>
</div>
<section id="embed-the-data-simultaneously-using-multiple-adjacency-spectral-embedding-mase">
<h2>Embed the data simultaneously using Multiple Adjacency Spectral Embedding (MASE)<a class="headerlink" href="#embed-the-data-simultaneously-using-multiple-adjacency-spectral-embedding-mase" title="Permalink to this heading">#</a></h2>
<p>The purpose of MASE is to obtain a low dimensional representation of the three correlation matrices such that the embedded correlation matrices can be compared to each other in a meaningful way <span id="id1">[<a class="reference internal" href="#id4" title="JesÃºs Arroyo, Avanti Athreya, Joshua Cape, Guodong Chen, Carey E. Priebe, and Joshua T. Vogelstein. Inference for multiple heterogeneous networks with a common invariant subspace. Journal of Machine Learning Research, 22(142):1-49, 2021. URL: http://jmlr.org/papers/v22/19-558.html.">Arroyo <em>et al.</em>, 2021</a>]</span>. Unlike omnibus embedding, MASE provides a common vertex representation across all correlation matrices. One can view this as a factoring out of common structures that are shared across all correlation matrices. This common representation of vertices provide a low dimensional vector per region of the brain, resulting in a <span class="math notranslate nohighlight">\(322\times d\)</span> matrix per genotype where <span class="math notranslate nohighlight">\(d\)</span> is the “embedding dimension” and <span class="math notranslate nohighlight">\(d &lt;&lt; 332\)</span>.</p>
<p>We will use the embeddings in order to perform hierchical clustering <span id="id2">[<a class="reference internal" href="#id11" title="Thomas L Athey, Tingshan Liu, Benjamin D Pedigo, and Joshua T Vogelstein. Autogmm: automatic and hierarchical gaussian mixture modeling in python. arXiv preprint arXiv:1909.02688, 2019.">Athey <em>et al.</em>, 2019</a>, <a class="reference internal" href="#id10" title="Vince Lyzinski, Daniel L Sussman, Minh Tang, Avanti Athreya, and Carey E Priebe. Perfect clustering for stochastic blockmodel graphs via adjacency spectral embedding. Electronic journal of statistics, 8(2):2905–2922, 2014.">Lyzinski <em>et al.</em>, 2014</a>, <a class="reference internal" href="#id9" title="Carey E Priebe, Youngser Park, Joshua T Vogelstein, John M Conroy, Vince Lyzinski, Minh Tang, Avanti Athreya, Joshua Cape, and Eric Bridgeford. On a two-truths phenomenon in spectral graph clustering. Proceedings of the National Academy of Sciences, 116(13):5995–6000, 2019.">Priebe <em>et al.</em>, 2019</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mase</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">embed</span><span class="o">.</span><span class="n">MultipleASE</span><span class="p">()</span>
<span class="n">Vhat</span> <span class="o">=</span> <span class="n">mase</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">corr</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corr</span> <span class="ow">in</span> <span class="n">cor_dat</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="n">Xhats</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">mase</span><span class="o">.</span><span class="n">scores_</span><span class="p">:</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
    <span class="n">Xhat</span> <span class="o">=</span> <span class="n">Vhat</span> <span class="o">@</span> <span class="n">u</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    
    <span class="n">Xhats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Xhat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="perform-hierarchical-clustering">
<h2>Perform hierarchical clustering<a class="headerlink" href="#perform-hierarchical-clustering" title="Permalink to this heading">#</a></h2>
<p>First we concatenate the embeddings resulting in a matrix with size <span class="math notranslate nohighlight">\(332 \times 3d\)</span>. We will iteratively divide the regions into two clusters. For example, we divide the <span class="math notranslate nohighlight">\(332\)</span> regions into two clusters, and each resulting cluster will be divided into two more clusters, etc. The clustering algorithm used at each division is Gaussian mixture modeling.</p>
<p>The clustering algorithm will tell us which regions should be grouped together, and subsequently forms our “subgraphs” given by the clusterings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Vhat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(332, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">DivisiveCluster</span><span class="p">(</span><span class="n">max_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">cluster_labels</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">Vhat</span><span class="p">,</span> <span class="n">fcluster</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cluster_label_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cluster_level_1&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster_level_2&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster_level_3&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-the-cluster-labeling-along-with-apriori-labels-using-sankey-diagrams">
<h2>Plotting the cluster labeling along with apriori labels using Sankey diagrams<a class="headerlink" href="#plotting-the-cluster-labeling-along-with-apriori-labels-using-sankey-diagrams" title="Permalink to this heading">#</a></h2>
<p>Sankey diagrams tell us which regions or subregions belong to which clusters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_groups</span><span class="p">(</span><span class="n">label_matrix</span><span class="p">):</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">label_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="n">upper_cluster_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">label_matrix</span><span class="p">[:,</span> <span class="n">level</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">upper_cluster_id</span> <span class="ow">in</span> <span class="n">upper_cluster_ids</span><span class="p">:</span>
            <span class="n">lower_cluster_ids</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">label_matrix</span><span class="p">[</span><span class="n">label_matrix</span><span class="p">[:,</span> <span class="n">level</span><span class="p">]</span> <span class="o">==</span> <span class="n">upper_cluster_id</span><span class="p">][:,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lower_cluster_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lower_cluster_ids</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">upper_cluster_id</span> <span class="o">==</span> <span class="n">lower_cluster_id</span><span class="p">:</span>
                    <span class="n">lower_cluster_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">upper_cluster_id</span><span class="p">,</span> <span class="n">lower_cluster_id</span><span class="p">,</span> <span class="n">counts</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    
    <span class="n">source</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">append_apriori_labels</span><span class="p">(</span><span class="n">apriori_labels</span><span class="p">,</span> <span class="n">cluster_matrix</span><span class="p">):</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
    <span class="n">apriori_labels_encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">apriori_labels</span><span class="p">)</span>
    <span class="n">apriori_labels_encoded</span> <span class="o">=</span> <span class="n">apriori_labels_encoded</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Increase the original cluster_matrix labels</span>
    <span class="n">cluster_matrix_</span> <span class="o">=</span> <span class="n">cluster_matrix</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">apriori_labels_encoded</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">apriori_labels_encoded</span><span class="p">,</span> <span class="n">cluster_matrix_</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>

<span class="n">hemispheric_clusters</span><span class="p">,</span> <span class="n">encoded_labels</span> <span class="o">=</span> <span class="n">append_apriori_labels</span><span class="p">(</span><span class="n">node_labels</span><span class="o">.</span><span class="n">Hemisphere</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">)</span>

<span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">count_groups</span><span class="p">(</span><span class="n">hemispheric_clusters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Sankey</span><span class="p">(</span>
    <span class="n">node</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
      <span class="n">pad</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
      <span class="n">thickness</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
      <span class="n">line</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">),</span>
      <span class="n">label</span> <span class="o">=</span> <span class="n">encoded_labels</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hemispheric_clusters</span><span class="p">))]</span>
    <span class="p">),</span>
    <span class="n">link</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
      <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span>
      <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">,</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
  <span class="p">))])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Hemispheric Clustering&quot;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3e8bfbd4c4088d84a54ff6b2f2e1d4931ac4f28c053b83fdc6b3ccb3215690a8.png" src="_images/3e8bfbd4c4088d84a54ff6b2f2e1d4931ac4f28c053b83fdc6b3ccb3215690a8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level_1_clusters</span><span class="p">,</span> <span class="n">encoded_labels</span> <span class="o">=</span> <span class="n">append_apriori_labels</span><span class="p">(</span><span class="n">node_labels</span><span class="o">.</span><span class="n">Level_1</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">)</span>

<span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">count_groups</span><span class="p">(</span><span class="n">level_1_clusters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Sankey</span><span class="p">(</span>
    <span class="n">node</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
      <span class="n">pad</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
      <span class="n">thickness</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
      <span class="n">line</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">),</span>
      <span class="n">label</span> <span class="o">=</span> <span class="n">encoded_labels</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">level_1_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]))],</span>
    <span class="p">),</span>
    <span class="n">link</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
      <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span>
      <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">,</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
  <span class="p">))])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Level 1 Clustering&quot;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/61136d44e3ae05b1a6b91a0f87d9c56e90429999f7d3d2274cf4be2a5bf8c160.png" src="_images/61136d44e3ae05b1a6b91a0f87d9c56e90429999f7d3d2274cf4be2a5bf8c160.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">cluster_label_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;../outs/mase_clustering.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-different-clustering-levels-using-heatmaps">
<h2>Visualizing different clustering levels using heatmaps<a class="headerlink" href="#visualizing-different-clustering-levels-using-heatmaps" title="Permalink to this heading">#</a></h2>
<p>Heatmaps can qualitatively tell us if there are any underlying structures within the clusters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Cluster_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>

<span class="n">meta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">cl</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">meta</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Structure</th>
      <th>Abbreviation</th>
      <th>Hemisphere</th>
      <th>Level_1</th>
      <th>Level_2</th>
      <th>Level_3</th>
      <th>Level_4</th>
      <th>Subdivisions_7</th>
      <th>index</th>
      <th>index2</th>
      <th>clusfound</th>
      <th>Subdivisions_7_nowm</th>
      <th>Hemisphere_abbrev</th>
      <th>Level_1_abbrev</th>
      <th>Cluster_1</th>
      <th>Cluster_2</th>
      <th>Cluster_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cingulate_Cortex_Area_24a</td>
      <td>A24a</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>1</td>
      <td>1.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>F</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Cingulate_Cortex_Area_24a_prime</td>
      <td>A24aPrime</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>2</td>
      <td>2.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>F</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Cingulate_Cortex_Area_24b</td>
      <td>A24b</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>3</td>
      <td>3.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>F</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Cingulate_Cortex_Area_24b_prime</td>
      <td>A24bPrime</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>4</td>
      <td>4.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>F</td>
      <td>1</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Cingulate_Cortex_Area_29a</td>
      <td>A29a</td>
      <td>Left</td>
      <td>1_forebrain</td>
      <td>1_secondary_prosencephalon</td>
      <td>1_isocortex</td>
      <td>2_cingulate_cortex</td>
      <td>1_isocortex</td>
      <td>5</td>
      <td>5.0</td>
      <td>0</td>
      <td>1_isocortex</td>
      <td>L</td>
      <td>F</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Plot to make sure nothing is wrong</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
        <span class="c1">#constrained_layout=True, </span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="p">)</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">genotype</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cor_dat</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">gp</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">adjplot</span><span class="p">(</span>
            <span class="n">cor_dat</span><span class="p">[</span><span class="n">genotype</span><span class="p">],</span> 
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Cluster_</span><span class="si">{</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genotype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        
    <span class="c1">#fig.savefig(f&quot;./figures/2022-02-02-multigraph-clustering-level-{l + 1}.png&quot;, bbox_inches=&#39;tight&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/92c9e582c5375a09539ca8db6e6faabc27f02d8dd56a206984838313968d5c91.png" src="_images/92c9e582c5375a09539ca8db6e6faabc27f02d8dd56a206984838313968d5c91.png" />
<img alt="_images/5f7cc54f3dba7e1c8612b237ef45af1a589603b7f20844da2975b37d8ad8c495.png" src="_images/5f7cc54f3dba7e1c8612b237ef45af1a589603b7f20844da2975b37d8ad8c495.png" />
<img alt="_images/cf3eed9c6d83b3ccaadba7232f8f6eae4fc86d2fc5c9dce9e5b336700453857f.png" src="_images/cf3eed9c6d83b3ccaadba7232f8f6eae4fc86d2fc5c9dce9e5b336700453857f.png" />
</div>
</div>
<p>It seems like cluster structures are predominantly driven by the large correlations in the APOE3 genotype</p>
</section>
<section id="testing-for-significantly-different-clusters-at-various-levels">
<h2>Testing for significantly different clusters at various levels<a class="headerlink" href="#testing-for-significantly-different-clusters-at-various-levels" title="Permalink to this heading">#</a></h2>
<p>Again, the clusters tell us which regions should be grouped together. Hence, each cluster forms our subgraph. For each subgraph, we test whether the distribution of the latent positions (aka the embeddings) are significantly different. Specifically we test</p>
<div class="amsmath math notranslate nohighlight" id="equation-a4d840a2-3d51-4388-a41d-0d7b5f074c28">
<span class="eqno">()<a class="headerlink" href="#equation-a4d840a2-3d51-4388-a41d-0d7b5f074c28" title="Permalink to this equation">#</a></span>\[\begin{align}
H_0:&amp; \qquad F_{APOE2}=F_{APOE3}=F_{APOE4}\\
H_A:&amp; \qquad \text{At least one pair of distributions is different}
\end{align}\]</div>
<p>using a 3-sample distance correlation. We correct for multiple hypothesis testing via Holm-Bonferroni correction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">holm_bonferroni</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="n">sorted_pvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>
    <span class="n">corrected_alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">m</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sorted_pvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">corrected_alpha</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">m</span>
            <span class="n">corrected_alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    
    <span class="k">return</span> <span class="n">corrected_alpha</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cluster_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">level_labels</span> <span class="o">=</span> <span class="n">cluster_labels</span><span class="p">[:,</span> <span class="n">level</span><span class="p">]</span>
    <span class="n">uniques</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">level_labels</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">uniques</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">level_labels</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">)</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xhat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">Xhat</span> <span class="ow">in</span> <span class="n">Xhats</span><span class="p">]</span>
        
        <span class="n">ksample</span> <span class="o">=</span> <span class="n">hyppo</span><span class="o">.</span><span class="n">ksample</span><span class="o">.</span><span class="n">KSample</span><span class="p">(</span><span class="s2">&quot;dcorr&quot;</span><span class="p">)</span>
        <span class="n">stat</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">ksample</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
        
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">level</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">pval</span><span class="p">))</span>
        
<span class="n">ksample_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cluster_level&quot;</span><span class="p">,</span> <span class="s2">&quot;Cluster_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pval&quot;</span><span class="p">])</span>

<span class="n">corrected_alpha</span> <span class="o">=</span> <span class="n">holm_bonferroni</span><span class="p">(</span><span class="n">ksample_df</span><span class="o">.</span><span class="n">pval</span><span class="p">)</span>

<span class="n">ksample_df</span><span class="p">[</span><span class="s2">&quot;significant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ksample_df</span><span class="o">.</span><span class="n">pval</span> <span class="o">&lt;</span> <span class="n">corrected_alpha</span>
</pre></div>
</div>
</div>
</div>
<section id="ksample-testing-results">
<h3>Ksample testing results<a class="headerlink" href="#ksample-testing-results" title="Permalink to this heading">#</a></h3>
<p>We see that most clusters are significantly different.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ksample_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cluster_level</th>
      <th>Cluster_id</th>
      <th>pval</th>
      <th>significant</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>1.774613e-51</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>1.149383e-12</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>1.774613e-51</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2</td>
      <td>2.072957e-07</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>3</td>
      <td>1.937743e-12</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>0</td>
      <td>1.774613e-51</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2</td>
      <td>2</td>
      <td>2.072957e-07</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2</td>
      <td>4</td>
      <td>1.825486e-12</td>
      <td>True</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2</td>
      <td>5</td>
      <td>5.191775e-07</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="testing-for-differences-in-pairwise-subgraph-covariances">
<h3>Testing for differences in pairwise subgraph covariances<a class="headerlink" href="#testing-for-differences-in-pairwise-subgraph-covariances" title="Permalink to this heading">#</a></h3>
<p>The test above tells us whether a pair, or all, genotypes are different. For example, a significant result may mean that APOE2 and APOE3 are different. However, it is also possible that APOE2, APOE3, and APOE4 are all different. To figure out which pairs are different, we do a post-hoc pairwise test. That is, for each cluster (aka subgraph), we test whether each pair of genotypes are different. Specifically,</p>
<div class="amsmath math notranslate nohighlight" id="equation-9a96d2a1-09c6-41d7-8d92-25836357ad9e">
<span class="eqno">()<a class="headerlink" href="#equation-9a96d2a1-09c6-41d7-8d92-25836357ad9e" title="Permalink to this equation">#</a></span>\[\begin{align}
H_0:&amp; \qquad F_{i}=F_{j}\\
H_A:&amp; \qquad F_i \neq F_j
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(i, j\)</span> denotes a particular genotype. Again, we use distance correlation with Holm-Bonferroni correction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">genotypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;APOE22&#39;</span><span class="p">,</span> <span class="s1">&#39;APOE33&#39;</span><span class="p">,</span> <span class="s1">&#39;APOE44&#39;</span><span class="p">]</span>

<span class="n">ksample</span> <span class="o">=</span> <span class="n">hyppo</span><span class="o">.</span><span class="n">ksample</span><span class="o">.</span><span class="n">KSample</span><span class="p">(</span><span class="s2">&quot;dcorr&quot;</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">cluster_df</span> <span class="o">=</span> <span class="n">ksample_df</span><span class="p">[</span><span class="n">ksample_df</span><span class="o">.</span><span class="n">significant</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cluster_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">cluster_id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">Cluster_id</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">cluster_labels</span><span class="p">[:,</span> <span class="n">row</span><span class="o">.</span><span class="n">Cluster_level</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster_id</span>
    
    <span class="n">cluster_Xhat</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xhat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">Xhat</span> <span class="ow">in</span> <span class="n">Xhats</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">genotypes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">genotypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="n">h</span><span class="p">:</span>
                <span class="c1">#res.append([cluster_id, g, h, 1])</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ksample</span> <span class="o">=</span> <span class="n">hyppo</span><span class="o">.</span><span class="n">ksample</span><span class="o">.</span><span class="n">KSample</span><span class="p">(</span><span class="s2">&quot;dcorr&quot;</span><span class="p">)</span>

                <span class="n">_</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">ksample</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">cluster_Xhat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cluster_Xhat</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">Cluster_level</span><span class="p">,</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">pval</span><span class="p">])</span>
                
<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cluster_level&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster_id&quot;</span><span class="p">,</span> <span class="s2">&quot;Genotype_1&quot;</span><span class="p">,</span> <span class="s2">&quot;Genotype_2&quot;</span><span class="p">,</span> <span class="s2">&quot;pval&quot;</span><span class="p">])</span>
<span class="n">res</span><span class="p">[</span><span class="s2">&quot;log(pval)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">pval</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_alpha</span> <span class="o">=</span> <span class="n">holm_bonferroni</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">pval</span><span class="p">)</span>

<span class="n">res</span><span class="p">[</span><span class="s2">&quot;significant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">pval</span> <span class="o">&lt;</span> <span class="n">corrected_alpha</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">squareform</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">15</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">cluster_id</span><span class="p">)):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">cluster_id</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;log(pval)&quot;</span><span class="p">])</span>
    <span class="n">sig_labels</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">([</span><span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="n">sig</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">significant</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="n">sig_labels</span><span class="p">,</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;log(pval)&quot;</span><span class="p">]),</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">genotypes</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">genotypes</span><span class="p">,</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">corrected_alpha</span><span class="p">),</span> 
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span> <span class="n">square</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/466804df1d516b786f8907f3578bc00f79763b303c41c5708869ba14e864ee25.png" src="_images/466804df1d516b786f8907f3578bc00f79763b303c41c5708869ba14e864ee25.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#out = pd.concat([node_labels, cluster_label_df], axis=1)</span>

<span class="c1">#out.to_csv(&quot;./out.csv&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="docutils container" id="id3">
<div class="citation" id="id4" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">AAC+21</a><span class="fn-bracket">]</span></span>
<p>JesÃºs Arroyo, Avanti Athreya, Joshua Cape, Guodong Chen, Carey E. Priebe, and Joshua T. Vogelstein. Inference for multiple heterogeneous networks with a common invariant subspace. <em>Journal of Machine Learning Research</em>, 22(142):1–49, 2021. URL: <a class="reference external" href="http://jmlr.org/papers/v22/19-558.html">http://jmlr.org/papers/v22/19-558.html</a>.</p>
</div>
<div class="citation" id="id11" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">ALPV19</a><span class="fn-bracket">]</span></span>
<p>Thomas L Athey, Tingshan Liu, Benjamin D Pedigo, and Joshua T Vogelstein. Autogmm: automatic and hierarchical gaussian mixture modeling in python. <em>arXiv preprint arXiv:1909.02688</em>, 2019.</p>
</div>
<div class="citation" id="id10" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">LST+14</a><span class="fn-bracket">]</span></span>
<p>Vince Lyzinski, Daniel L Sussman, Minh Tang, Avanti Athreya, and Carey E Priebe. Perfect clustering for stochastic blockmodel graphs via adjacency spectral embedding. <em>Electronic journal of statistics</em>, 8(2):2905–2922, 2014.</p>
</div>
<div class="citation" id="id9" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">PPV+19</a><span class="fn-bracket">]</span></span>
<p>Carey E Priebe, Youngser Park, Joshua T Vogelstein, John M Conroy, Vince Lyzinski, Minh Tang, Avanti Athreya, Joshua Cape, and Eric Bridgeford. On a two-truths phenomenon in spectral graph clustering. <em>Proceedings of the National Academy of Sciences</em>, 116(13):5995–6000, 2019.</p>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#embed-the-data-simultaneously-using-multiple-adjacency-spectral-embedding-mase">Embed the data simultaneously using Multiple Adjacency Spectral Embedding (MASE)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-hierarchical-clustering">Perform hierarchical clustering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-cluster-labeling-along-with-apriori-labels-using-sankey-diagrams">Plotting the cluster labeling along with apriori labels using Sankey diagrams</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-different-clustering-levels-using-heatmaps">Visualizing different clustering levels using heatmaps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-significantly-different-clusters-at-various-levels">Testing for significantly different clusters at various levels</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ksample-testing-results">Ksample testing results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-differences-in-pairwise-subgraph-covariances">Testing for differences in pairwise subgraph covariances</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jaewon Chung, Eric B. Bridgeford
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>